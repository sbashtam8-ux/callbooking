<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Callbooking Performance</title>
<style>
  :root{
    --green1:#66d17a; /* روشن */
    --green2:#0b7a3f; /* تیره */
    --yellow:#fef3c7;
    --red:#d72631;
    --bg:#f0f2f5;
  }
  *{box-sizing:border-box}
  body{font-family:Calibri, sans-serif;background:var(--bg);margin:0;padding:0;direction:rtl;color:#111}
  header{
    background:linear-gradient(90deg,var(--green1),var(--green2));
    color:#fff;padding:20px;text-align:center;font-size:24px;font-weight:800;
    box-shadow:0 4px 12px rgba(0,0,0,0.12)
  }
  main{max-width:1100px;margin:18px auto;padding:16px;display:flex;flex-direction:column;gap:16px}
  .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h2{margin:0 0 10px;color:var(--green2);font-size:18px}
  .row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
  .row label{min-width:140px;text-align:right;font-weight:600}
  .small-input{width:260px;padding:8px;border:1px solid #ccc;border-radius:8px;font-size:14px}
  .full-input{flex:1;padding:8px;border:1px solid #ccc;border-radius:8px;font-size:14px}
  .file-box{display:flex;align-items:center;gap:8px}
  .file-btn{padding:8px 10px;border-radius:8px;border:1px solid #ccc;background:#ccc;cursor:pointer}
  .file-name{font-size:14px;color:#333}
  .controls{display:flex;gap:10px;align-items:center;margin-top:6px}
  button.primary{background:var(--green2);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
  button.danger{background:#dc2626;color:#fff;padding:8px 12px;border-radius:8px;border:none;display:none;cursor:pointer}
  table{width:100%;border-collapse:collapse;margin-top:12px;text-align:right}
  th,td{border:1px solid #e9e9e9;padding:10px;vertical-align:top}
  th{background:#fafafa;color:#111;font-weight:700}
  td.problem{max-width:420px;word-wrap:break-word}
  tbody tr:hover{background:#fbfffb}
  canvas{width:100% !important;height:360px !important;margin-top:10px}
  .recordings-list{margin-top:10px}
  .agent-block{border:1px solid #eee;padding:10px;border-radius:8px;margin-bottom:8px;background:#fff}
  .file-item{display:flex;gap:10px;align-items:center;margin:6px 0}
  .file-item .meta{font-size:13px;color:#333}
  .muted{color:#666;font-size:13px}
  a.download-link{color:#0645ad;text-decoration:none;font-weight:600}
  audio{margin-left:8px}
  @media(max-width:720px){
    .row{flex-direction:column;align-items:stretch}
    .row label{min-width:unset;text-align:left}
    .small-input{width:100%}
  }
</style>
</head>
<body>
<header>Callbooking Performance</header>
<main>

  <!-- آموزش -->
  <div class="card">
    <h2>مشکلات و نیاز آموزشی کارشناسان / ثبت توسط تیم آموزش</h2>

    <form id="trainingForm" autocomplete="off" onsubmit="return false;">
      <div class="row">
        <label for="trainingName">نام کارشناس</label>
        <input id="trainingName" class="small-input" type="text" />
      </div>

      <div class="row">
        <label for="trainingScore">امتیاز</label>
        <input id="trainingScore" class="small-input" type="number" min="0" max="80" />
      </div>

      <div class="row">
        <label for="trainingIssue">مشکلات کارشناس</label>
        <input id="trainingIssue" class="full-input" type="text" />
      </div>

      <div class="row">
        <label>فایل شنود</label>
        <div class="file-box">
          <button type="button" id="chooseFileBtn" class="file-btn">انتخاب فایل</button>
          <span id="fileLabel" class="file-name">فایل شنود</span>
          <input id="audioFile" type="file" style="display:none" />
        </div>
      </div>

      <div class="controls">
        <button id="submitTraining" class="primary" type="button">ثبت</button>
        <button id="resetTraining" class="danger" type="button">ریست (مدیر)</button>
      </div>
    </form>

    <table id="trainingTable" aria-label="training-table">
      <thead><tr><th>نام کارشناس</th><th>امتیاز</th><th>مشکلات کارشناس</th><th>شنود</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- کوردیناتورها -->
  <div class="card">
    <h2>کارشناسان نیازمند به دوره همراهی / ثبت توسط کوردیناتورها</h2>

    <form id="callForm" autocomplete="off" onsubmit="return false;">
      <div class="row">
        <label for="agentName">نام کارشناس</label>
        <input id="agentName" class="small-input" type="text" />
      </div>

      <div class="row">
        <label for="coordinatorName2">نام کوردیناتور</label>
        <input id="coordinatorName2" class="small-input" type="text" />
      </div>

      <div class="row">
        <label for="note2">مشکلات کارشناس</label>
        <input id="note2" class="full-input" type="text" />
      </div>

      <div class="controls">
        <button id="submitCall" class="primary" type="button">ثبت</button>
        <button id="resetCall" class="danger" type="button">ریست (مدیر)</button>
      </div>
    </form>

    <table id="agentsTable">
      <thead><tr><th>نام کارشناس</th><th>نام کوردیناتور</th><th>مشکلات کارشناس</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- نمودار -->
  <div class="card">
    <h2>امتیاز کارشناسان</h2>
    <canvas id="performanceChart"></canvas>
  </div>

  <!-- بخش مرتب فایل‌های شنود بر اساس کارشناس -->
  <div class="card">
    <h2>فایل‌های شنود (مرتب‌شده بر اساس کارشناس)</h2>
    <div id="recordingsContainer" class="recordings-list"></div>
    <div class="muted">فایل‌ها با تاریخ آپلود مرتب شده‌اند؛ فقط مدیر می‌تواند پخش و دانلود کند.</div>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ====== Keys & admin ====== */
const KEY_TRAININGS = 'cb_trainings_final_v3';
const KEY_CALLS = 'cb_calls_final_v3';
let isAdmin = false;
const pwd = prompt("رمز مدیر را وارد کنید (خالی بگذارید برای کارشناس):");
if (pwd === "123456") { isAdmin = true; document.querySelectorAll('.danger').forEach(b=>b.style.display='inline-block'); }

/* ====== elements ====== */
const audioFileInput = document.getElementById('audioFile');
const chooseFileBtn = document.getElementById('chooseFileBtn');
const fileLabel = document.getElementById('fileLabel');

chooseFileBtn.addEventListener('click', () => audioFileInput.click());
audioFileInput.addEventListener('change', () => {
  if(audioFileInput.files && audioFileInput.files.length > 0)
    fileLabel.textContent = audioFileInput.files[0].name;
  else
    fileLabel.textContent = 'فایل شنود';
});

/* ====== باقی کدهای ثبت و ذخیره و نمودار ====== */
// همون کدهایی که قبلاً داشتیم برای ذخیره، ریست، جدول و نمودار
// renderTrainings(), renderCalls(), updateChart() و غیره
</script>
</body>
</html>
