<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Callbooking Performance</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Vazir&display=swap');

body {
    font-family: 'Vazir', sans-serif;
    background:#f0f2f5;
    margin:0;
    padding:0;
    direction:rtl;
    text-align:right;
}

header {
    background: linear-gradient(135deg, #28a745, #218838);
    color:white;
    padding:30px 0;
    text-align:center;
    font-size:36px;
    font-weight:bold;
    border-bottom-left-radius:15px;
    border-bottom-right-radius:15px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    animation: gradientShift 10s ease infinite;
    background-size: 300% 300%;
}

@keyframes gradientShift {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

main {
    padding:30px;
    max-width:1200px;
    margin:auto;
    display:flex;
    flex-direction:column;
    gap:30px;
}

.card {
    background:white;
    padding:25px;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
    transition:0.3s;
}
.card:hover {
    transform: translateY(-5px);
    box-shadow:0 15px 30px rgba(0,0,0,0.2);
}

.card h2 {
    margin-top:0;
    color:#28a745;
    font-size:28px;
    text-align:right;
}

.form-column {
    display:flex;
    flex-direction:column;
    gap:15px;
}

.form-field {
    display:flex;
    flex-direction:column;
    gap:5px;
    align-items:flex-start;
}

input, select {
    padding:12px;
    border-radius:10px;
    border:1px solid #ccc;
    width:100%;
    font-size:16px;
    transition:0.3s;
}
input:focus, select:focus {
    border-color:#28a745;
    box-shadow:0 0 8px rgba(40,167,69,0.4);
    outline:none;
}

button {
    padding:12px 18px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:16px;
    transition:0.3s;
}
button.submit { background-color:#28a745; color:white; }
button.submit:hover { background-color:#218838; }
button.reset { background-color:#dc2626; color:white; }
button.reset:hover { background-color:#991b1b; }

table { width:100%; border-collapse:collapse; margin-top:20px; text-align:right; transition:0.3s; }
th, td { border:1px solid #ddd; padding:12px; vertical-align:middle; transition:0.3s; }
th { background-color:#f3f4f6; color:#111827; }
tbody tr:hover { background-color:#d1fae5; }

canvas { margin-top:20px; width:100% !important; height:400px !important; }

.admin-section { display:none; flex-direction:column; gap:15px; margin-top:20px; }
.files-list div { margin-bottom:10px; }

</style>
</head>
<body>

<header>Callbooking Performance</header>

<main>

<!-- ثبت توسط تیم آموزش -->
<div class="card">
<h2>ثبت توسط تیم آموزش</h2>
<form id="trainingForm" class="form-column">
  <div class="form-field">
    <label>نام کارشناس:</label>
    <input type="text" id="trainingName" placeholder="نام کارشناس">
  </div>
  <div class="form-field">
    <label>امتیاز:</label>
    <input type="number" id="trainingScore" placeholder="0-80" min="0" max="80">
  </div>
  <div class="form-field">
    <label>مشکلات کارشناس:</label>
    <input type="text" id="trainingIssue" placeholder="مشکلات کارشناس">
  </div>
  <div class="form-field">
    <label>فایل شنود:</label>
    <input type="file" id="auditFileUpload">
  </div>
  <div style="display:flex; gap:15px; justify-content:flex-start; margin-top:15px;">
    <button type="submit" class="submit">ثبت</button>
    <button type="button" id="resetTrainingButton" class="reset">ریست</button>
  </div>
</form>
<table id="trainingTable">
<thead><tr><th>نام کارشناس</th><th>امتیاز</th><th>مشکلات کارشناس</th><th>فایل شنود</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- ثبت توسط کوردیناتور -->
<div class="card">
<h2>ثبت توسط کوردیناتور</h2>
<form id="callForm" class="form-column">
  <div class="form-field">
    <label>نام کارشناس:</label>
    <input type="text" id="agentName" placeholder="نام کارشناس">
  </div>
  <div class="form-field">
    <label>نام کوردیناتور:</label>
    <input type="text" id="coordinatorName2" placeholder="نام کوردیناتور">
  </div>
  <div class="form-field">
    <label>مشکلات کارشناس:</label>
    <input type="text" id="note2" placeholder="مشکلات کارشناس">
  </div>
  <div style="display:flex; gap:15px; justify-content:flex-start; margin-top:15px;">
    <button type="submit" class="submit">ثبت</button>
    <button type="button" id="resetFormButton" class="reset">ریست</button>
  </div>
</form>
<table id="agentsTable">
<thead><tr><th>نام کارشناس</th><th>نام کوردیناتور</th><th>مشکلات کارشناس</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- نمودار -->
<div class="card">
<h2>امتیاز کارشناسان</h2>
<canvas id="performanceChart"></canvas>
</div>

<!-- بخش فایل‌های شنود (مدیر) -->
<div class="card admin-section" id="adminSection">
<h2>فایل‌های شنود (مدیر)</h2>
<div class="files-list" id="filesList"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// دسترسی مدیر
const adminPassword = "123456";
let isAdmin = false;
const userPass = prompt("رمز مدیر را وارد کنید:");
if(userPass === adminPassword){
    isAdmin = true;
    document.getElementById('adminSection').style.display="flex";
}

// داده‌ها
let trainingData = [];
let agentsData = [];

// فرم تیم آموزش
const trainingForm = document.getElementById('trainingForm');
trainingForm.addEventListener('submit', e=>{
    e.preventDefault();
    const name = document.getElementById('trainingName').value.trim();
    const score = parseInt(document.getElementById('trainingScore').value);
    const issue = document.getElementById('trainingIssue').value.trim();
    const fileInput = document.getElementById('auditFileUpload');
    if(!name || isNaN(score) || score<0 || score>80) return alert("اطلاعات صحیح وارد شود");
    let fileName = fileInput.files[0] ? fileInput.files[0].name : '';
    trainingData.push({name, score, issue, fileName});
    updateTrainingTable();
    if(isAdmin && fileInput.files[0]){
        const div = document.createElement("div");
        div.innerHTML=`${name} - ${fileName} - <a href="${URL.createObjectURL(fileInput.files[0])}" download>دانلود</a>`;
        document.getElementById('filesList').appendChild(div);
    }
    trainingForm.reset();
});

function updateTrainingTable(){
    const tbody = document.querySelector("#trainingTable tbody");
    tbody.innerHTML="";
    trainingData.forEach(d=>{
        const tr = document.createElement("tr");
        tr.innerHTML=`<td>${d.name}</td><td>${d.score}</td><td>${d.issue}</td><td>${d.fileName}</td>`;
        tbody.appendChild(tr);
    });
}

// فرم کوردیناتور
const callForm = document.getElementById('callForm');
callForm.addEventListener('submit', e=>{
    e.preventDefault();
    const name = document.getElementById('agentName').value.trim();
    const coord = document.getElementById('coordinatorName2').value.trim();
    const note = document.getElementById('note2').value.trim();
    if(!name || !coord) return alert("اطلاعات صحیح وارد شود");
    agentsData.push({name, coord, note});
    updateAgentsTable();
    callForm.reset();
});

function updateAgentsTable(){
    const tbody = document.querySelector("#agentsTable tbody");
    tbody.innerHTML="";
    agentsData.forEach(d=>{
        const tr = document.createElement("tr");
        tr.innerHTML=`<td>${d.name}</td><td>${d.coord}</td><td>${d.note}</td>`;
        tbody.appendChild(tr);
    });
}

// ریست فرم‌ها برای مدیر
document.getElementById("resetTrainingButton").addEventListener("click", ()=>{
    if(isAdmin) {
        trainingData=[];
        updateTrainingTable();
        document.getElementById("filesList").innerHTML="";
    } else alert("فقط مدیر مجاز است");
});
document.getElementById("resetFormButton").addEventListener("click", ()=>{
    if(isAdmin) {
        agentsData=[];
        updateAgentsTable();
    } else alert("فقط مدیر مجاز است");
});

// نمودار حرفه‌ای
const ctx = document.getElementById('performanceChart').getContext('2d');
const chartData = {
    labels: [],
    datasets: [{
        label: 'امتیاز',
        data: [],
        backgroundColor: [],
        borderRadius: 6,
        barThickness: 30
    }]
};
const chartOptions = {
    responsive:true,
    plugins:{legend:{display:false}},
    scales:{y:{beginAtZero:true,max:80}}
};
const performanceChart = new Chart(ctx,{type:'bar',data:chartData,options:chartOptions});

function updateChart(){
    chartData.labels = trainingData.map(d=>d.name);
    chartData.datasets[0].data = trainingData.map(d=>d.score);
    chartData.datasets[0].backgroundColor = trainingData.map(d=>d.score<60 ? 'red':'green');
    performanceChart.update();
}

// بروزرسانی نمودار بعد از ثبت
trainingForm.addEventListener('submit',()=>updateChart());
</script>
</body>
</html>
